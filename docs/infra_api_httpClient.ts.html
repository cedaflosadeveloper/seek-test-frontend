<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: infra/api/httpClient.ts</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: infra/api/httpClient.ts</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import 'client-only';

import type { HttpClient, HttpRequest, HttpResponse } from '@/core/ports/httpClient';
import { tokenStorage } from '@/infra/storage/tokenStorage';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL ?? '';

/** Normaliza el endpoint respetando base URL y rutas internas. */
const buildUrl = (url: string) => {
  if (url.startsWith('http://') || url.startsWith('https://')) return url;
  const path = url.startsWith('/') ? url : `/${url}`;
  if (!API_BASE_URL || path.startsWith('/api')) return path;
  const base = API_BASE_URL.replace(/\/+$/, '');
  return `${base}${path}`;
};

/** Traduce la respuesta de error a un mensaje legible. */
const parseErrorMessage = (data: unknown, status: number) => {
  if (typeof data === 'string' &amp;&amp; data.trim()) return data;
  if (data &amp;&amp; typeof data === 'object' &amp;&amp; 'message' in data) {
    const message = (data as { message?: string | string[] }).message;
    if (Array.isArray(message)) return message.join(', ');
    if (typeof message === 'string') return message;
  }
  if (data &amp;&amp; typeof data === 'object' &amp;&amp; 'error' in data) {
    const error = (data as { error?: string }).error;
    if (typeof error === 'string') return error;
  }
  return `HTTP ${status}`;
};

/** Cliente HTTP para el frontend. */
export const httpClient: HttpClient = {
  async request&lt;T>(req: HttpRequest): Promise&lt;HttpResponse&lt;T>> {
    const token = tokenStorage.get();

    const headers: Record&lt;string, string> = {};
    if (req.body) headers['Content-Type'] = 'application/json';
    if (req.requiresAuth &amp;&amp; token) headers.Authorization = `Bearer ${token}`;

    const response = await fetch(buildUrl(req.url), {
      method: req.method,
      headers,
      body: req.body ? JSON.stringify(req.body) : undefined
    });

    const contentType = response.headers.get('content-type') ?? '';
    const hasJson = contentType.includes('application/json');
    let data: unknown = null;
    if (hasJson) {
      try {
        data = await response.json();
      } catch {
        data = null;
      }
    } else {
      const text = await response.text();
      data = text.length ? text : null;
    }

    if (!response.ok) {
      throw new Error(parseErrorMessage(data, response.status));
    }

    return { data: data as T };
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#authApi">authApi</a></li><li><a href="global.html#buildUrl">buildUrl</a></li><li><a href="global.html#createTaskAction">createTaskAction</a></li><li><a href="global.html#createTaskApi">createTaskApi</a></li><li><a href="global.html#deleteTaskAction">deleteTaskAction</a></li><li><a href="global.html#fetchJson">fetchJson</a></li><li><a href="global.html#getTaskById">getTaskById</a></li><li><a href="global.html#getTasks">getTasks</a></li><li><a href="global.html#getToken">getToken</a></li><li><a href="global.html#httpClient">httpClient</a></li><li><a href="global.html#loginAction">loginAction</a></li><li><a href="global.html#logoutAction">logoutAction</a></li><li><a href="global.html#mapApiTask">mapApiTask</a></li><li><a href="global.html#parseErrorMessage">parseErrorMessage</a></li><li><a href="global.html#request">request</a></li><li><a href="global.html#resolveStatus">resolveStatus</a></li><li><a href="global.html#taskApi">taskApi</a></li><li><a href="global.html#updateTaskAction">updateTaskAction</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Mon Feb 09 2026 19:41:42 GMT-0500 (Ecuador Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
